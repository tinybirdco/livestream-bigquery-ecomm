TOKEN "hourly_sales_endpoint_read_6039" READ

NODE endpoint
SQL >

    %
    SELECT toStartOfHour(timestamp) AS hour, sum(sales) AS total_sales
    FROM events
    WHERE 1=1
        {% if defined(start_dt) and defined(end_dt) %}
        AND timestamp BETWEEN toDateTime({{DateTime(start_dt)}}) AND toDateTime({{DateTime(end_dt)}})
        {% end %}
        {% if defined(family_param) %}
        AND product_id IN (
            SELECT id
            FROM prods
            WHERE
                family = {{String(family_param,"Sweatshirt",description="Product family parameter",required=True,)}}
        )
        {% end %}
    GROUP BY hour
    ORDER BY hour


